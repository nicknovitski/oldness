#!/usr/bin/env ruby

$LOAD_PATH.unshift(File.expand_path(File.dirname(__FILE__)) + '/../lib/')

require 'date'
require 'oldness'
require 'thor'

### parse date object from final argument
def date_from(arg)
  date_info = arg.split("-")

  if date_info[0].downcase.end_with?('bc')
    date_info[0][-2..-1] = ""
    date_info[0].insert(0,'-')
  end

  Date.new(*date_info.map {|v| v.to_i})
end

### parse date object from second argument
def date_of_first_work(medium)
  case medium
    when 'novel', 'book' then Date.new(1010) # Tale of Genji
    when 'film', 'movie' then Date.new(1894, 2, 5) # Jean Le Roy's "marvellous cinematograph"
    when 'comic', 'manga' then Date.new(1837) # Histoire de M. Vieux Bois
    when 'videogame' then Date.new(1951, 5, 4) # NIMROD
    when 'history' then Date.new(-411) # end of Thucydides' history
    when 'literature' then Date.new(-1300) # Epic of Gilgamesh
    when 'philosophy', 'religion' then Date.new(-800) # The Upanishads
    when 'animation', 'cartoon', 'anime'  then Date.new(1906, 4, 6) #Humorous Phases of Funny Faces
    else raise Exception
  end
end

class CLI < Thor

  desc "rating MEDIUM DATE", "give a star rating of oldness for a work in MEDIUM made on DATE"
  def rating(medium, date)
    print "*" * oldness_rating(date_from(date), date_of_first_work(medium)) + "\n"
  end
end

# todo: detect pluralization?
CLI.start

